<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Pipia Catálogo</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel (permite usar JSX sin compilar) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="bg-[#f7f2e9]">

  <div id="root"></div>

  <!-- TU APP COMPLETA EN JSX -->
  <script type="text/babel">

// ----------- Pega aquí TODA tu App.jsx tal cual -----------

const LS_PRODUCTS = "catalog_products_v1";
const LS_ORDERS = "catalog_orders_v1";
const LS_ADMIN_PASS = "catalog_admin_pass_v1";

const SAMPLE_PRODUCTS = [
  { id: "p1", title: "Camiseta Básica", price: 12.99, description: "Camiseta 100% algodón, varios colores.", image: null, stock: 20 },
  { id: "p2", title: "Taza Cerámica", price: 8.5, description: "Taza 350ml con diseño moderno.", image: null, stock: 50 },
];

// ===== utilidades =====
function loadProducts() {
  const raw = localStorage.getItem(LS_PRODUCTS);
  if (!raw) {
    localStorage.setItem(LS_PRODUCTS, JSON.stringify(SAMPLE_PRODUCTS));
    return SAMPLE_PRODUCTS;
  }
  try { return JSON.parse(raw); }
  catch { return SAMPLE_PRODUCTS; }
}

function saveProducts(p) {
  localStorage.setItem(LS_PRODUCTS, JSON.stringify(p));
}

function loadOrders() {
  const raw = localStorage.getItem(LS_ORDERS);
  if (!raw) {
    localStorage.setItem(LS_ORDERS, JSON.stringify([]));
    return [];
  }
  try { return JSON.parse(raw); }
  catch { return []; }
}

function saveOrders(o) {
  localStorage.setItem(LS_ORDERS, JSON.stringify(o));
}

function ensureAdminPassword() {
  const raw = localStorage.getItem(LS_ADMIN_PASS);
  if (!raw) {
    localStorage.setItem(LS_ADMIN_PASS, "admin123");
    return "admin123";
  }
  return raw;
}

// ============================================
//            APP COMPLETA
// ============================================

function App() {
  const [products, setProducts] = React.useState(() => loadProducts());
  const [orders, setOrders] = React.useState(() => loadOrders());
  const [cart, setCart] = React.useState([]);

  const [query, setQuery] = React.useState("");
  const [adminMode, setAdminMode] = React.useState(false);
  const [adminLogged, setAdminLogged] = React.useState(false);
  const [adminPassInput, setAdminPassInput] = React.useState("");
  const [editingProduct, setEditingProduct] = React.useState(null);

  React.useEffect(() => {
    ensureAdminPassword();
  }, []);

  React.useEffect(() => saveProducts(products), [products]);
  React.useEffect(() => saveOrders(orders), [orders]);

  // === Carrito ===
  function addToCart(productId, qty = 1) {
    const prod = products.find(p => p.id === productId);
    if (!prod) return;
    const currentQty = cart.reduce((s, it) => it.id === productId ? s + it.qty : s, 0);
    if (prod.stock != null && currentQty + qty > prod.stock)
      return alert("No hay suficiente stock");
    setCart(c => {
      const ex = c.find(it => it.id === productId);
      if (ex) return c.map(it => it.id === productId ? { ...it, qty: it.qty + qty } : it);
      return [...c, { id: productId, qty }];
    });
  }

  function removeFromCart(id) {
    setCart(c => c.filter(it => it.id !== id));
  }

  function updateCartQty(id, qty) {
    if (qty <= 0) return removeFromCart(id);
    setCart(c => c.map(it => it.id === id ? { ...it, qty } : it));
  }

  function cartTotal() {
    return cart.reduce((s, it) => {
      const p = products.find(px => px.id === it.id);
      return s + (p ? p.price * it.qty : 0);
    }, 0);
  }

  // === Hacer pedido ===
  function placeOrder(buyer) {
    if (!buyer.name || !buyer.contact) return alert("Ingresa nombre y contacto");

    const order = {
      id: "o_" + Date.now(),
      buyer,
      items: cart.map(i => ({ ...i })),
      total: cartTotal(),
      createdAt: new Date().toISOString(),
      status: "pending"
    };

    const newProducts = products.map(p => {
      const c = cart.find(i => i.id === p.id);
      return c ? { ...p, stock: p.stock != null ? p.stock - c.qty : p.stock } : p;
    });

    setProducts(newProducts);
    setOrders(o => [order, ...o]);
    setCart([]);

    alert("Pedido realizado: " + order.id);
  }

  // === Admin ===
  function adminLogin() {
    const saved = localStorage.getItem(LS_ADMIN_PASS) || "admin123";
    if (adminPassInput === saved) {
      setAdminLogged(true);
      setAdminMode(true);
    } else alert("Contraseña incorrecta");
  }

  function adminLogout() {
    setAdminLogged(false);
    setAdminMode(false);
    setEditingProduct(null);
  }

  function saveProduct(product) {
    if (!product.id) product.id = "p_" + Date.now();
    setProducts(ps => {
      const ex = ps.find(p => p.id === product.id);
      if (ex) return ps.map(p => p.id === product.id ? product : p);
      return [product, ...ps];
    });
    setEditingProduct(null);
  }

  function deleteProduct(id) {
    if (!confirm("Eliminar producto?")) return;
    setProducts(ps => ps.filter(p => p.id !== id));
  }

  async function readFileAsDataURL(file) {
    return await new Promise((res, rej) => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.onerror = rej;
      r.readAsDataURL(file);
    });
  }

  // === Componentes internos ===
  function ProductCard({ p }) {
    return (
      <div className="bg-[#fffaf3] rounded p-4 shadow flex flex-col">
        <div className="h-40 flex items-center justify-center mb-3 bg-gray-50 rounded overflow-hidden">
          {p.image ? <img src={p.image} className="max-h-full" /> : "Sin imagen"}
        </div>
        <h3 className="font-semibold text-lg">{p.title}</h3>
        <p className="text-sm text-gray-600 flex-1">{p.description}</p>
        <div className="mt-2 flex justify-between">
          <div className="font-bold text-xl">${p.price.toFixed(2)}</div>
          <button onClick={() => addToCart(p.id)} className="px-3 py-1 bg-blue-600 text-white rounded">
            Añadir
          </button>
        </div>
        <div className="text-xs text-gray-500 mt-1">Stock: {p.stock ?? "∞"}</div>
      </div>
    );
  }

  function OrderForm({ onPlace }) {
    const [name, setName] = React.useState("");
    const [contact, setContact] = React.useState("");
    return (
      <div className="flex gap-2">
        <input className="border p-1 rounded" placeholder="Nombre"
          value={name} onChange={e => setName(e.target.value)} />
        <input className="border p-1 rounded" placeholder="Contacto"
          value={contact} onChange={e => setContact(e.target.value)} />
        <button
          className="px-3 py-1 bg-green-600 text-white rounded"
          onClick={() => { onPlace({ name, contact }); setName(""); setContact(""); }}
        >
          Pagar
        </button>
      </div>
    );
  }

  // === UI ppal ===
  return (
    <div className="p-6 max-w-6xl mx-auto">

      <header className="flex justify-between mb-6 bg-[#fffaf3] p-3 rounded-xl shadow-sm">
        <h1 className="text-3xl font-bold text-[#4a3f35]">Pipia Catálogo</h1>

        <div className="flex gap-3 items-center">
          <div className="border rounded p-2 bg-[#fffaf3]">
            <div className="text-sm">Carrito</div>
            <div className="font-semibold">
              {cart.reduce((s, it) => s + it.qty, 0)} items
            </div>
          </div>

          {!adminLogged ? (
            <div className="bg-[#fffaf3] p-2 rounded border flex gap-2">
              <input type="password" value={adminPassInput}
                onChange={e => setAdminPassInput(e.target.value)}
                placeholder="Contraseña admin"
                className="px-2 py-1 border rounded" />
              <button onClick={adminLogin} className="px-3 py-1 bg-[#b8a48b] text-white rounded">
                Entrar
              </button>
            </div>
          ) : (
            <div className="bg-[#fffaf3] p-2 rounded border flex gap-2">
              <button className="px-3 py-1 bg-[#a3876a] text-white rounded"
                onClick={() => setAdminMode(s => !s)}>
                {adminMode ? "Tienda" : "Admin"}
              </button>
              <button className="px-3 py-1 bg-red-500 text-white rounded"
                onClick={adminLogout}>Salir</button>
            </div>
          )}
        </div>
      </header>

      {!adminMode ? (
        <main>
          <div className="flex gap-3 mb-4">
            <input className="flex-1 p-2 border rounded" placeholder="Buscar..."
              value={query} onChange={e => setQuery(e.target.value)} />
            <div className="bg-[#fffaf3] p-2 rounded border font-semibold">
              Total: ${cartTotal().toFixed(2)}
            </div>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {products
              .filter(p =>
                p.title.toLowerCase().includes(query.toLowerCase()) ||
                p.description.toLowerCase().includes(query.toLowerCase())
              )
              .map(p => (
                <ProductCard key={p.id} p={p} />
              ))}
          </div>

          <div className="mt-6 bg-[#fffaf3] p-4 rounded shadow">
            <h2 className="text-xl font-semibold">Carrito</h2>
