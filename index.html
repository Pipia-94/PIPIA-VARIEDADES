<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PIPIA VARIEDADES</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    background: #f2f2f2;
  }
  h1 { text-align: center; }

  .product {
    background: white;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 10px;
    box-shadow: 0 0 5px #aaa;
  }

  .cart {
    background: #fff2c6;
    padding: 15px;
    border-radius: 10px;
    margin-top: 20px;
  }

  button {
    padding: 10px;
    border: none;
    background: #0074ff;
    color: white;
    border-radius: 6px;
    cursor: pointer;
  }

  button.red {
    background: red;
  }
</style>
</head>

<body>

<h1>PIPIA VARIEDADES</h1>

<h2>Catálogo</h2>
<div id="catalog"></div>

<h2>Carrito</h2>
<div class="cart" id="cart"></div>

<h2>Admin</h2>
<input id="adminPass" type="password" placeholder="Contraseña admin">
<button onclick="loginAdmin()">Entrar</button>

<div id="adminPanel" style="display:none;">
  <h3>Agregar producto</h3>
  <input id="pName" placeholder="Nombre"><br><br>
  <input id="pPrice" type="number" placeholder="Precio"><br><br>
  <input id="pImg" type="file"><br><br>
  <button onclick="addProduct()">Agregar producto</button>
</div>

<script>
// =================== LOCALSTORAGE ===================
function load(key, fallback) {
  try {
    const val = JSON.parse(localStorage.getItem(key));
    return val !== null ? val : fallback;
  } catch {
    return fallback;
  }
}

function save(key, data) {
  localStorage.setItem(key, JSON.stringify(data));
}

// =================== DATA ===================
let products = load("products", []);
let cart = load("cart", []);

// =================== CATÁLOGO ===================
function renderCatalog() {
  const div = document.getElementById("catalog");
  div.innerHTML = "";

  if (products.length === 0) {
    div.innerHTML = "<em>No hay productos aún.</em>";
    return;
  }

  products.forEach((p, i) => {
    const box = document.createElement("div");
    box.className = "product";
    box.innerHTML = `
      <img src="${p.img}" width="120"><br>
      <strong>${p.name}</strong><br>
      Q${p.price}<br><br>
      <button onclick="addToCart(${i})">Agregar al carrito</button>
    `;
    div.appendChild(box);
  });
}

// =================== CARRITO ===================
function renderCart() {
  const div = document.getElementById("cart");

  if (cart.length === 0) {
    div.innerHTML = "<em>Carrito vacío</em>";
    return;
  }

  let html = "";
  let total = 0;

  cart.forEach((c, i) => {
    html += `
      <div>
        ${c.name} - Q${c.price}
        <button class="red" onclick="removeCart(${i})">X</button>
      </div>
    `;
    total += Number(c.price);
  });

  html += `<h3>Total: Q${total}</h3>`;
  div.innerHTML = html;
}

function addToCart(i) {
  cart.push(products[i]);
  save("cart", cart);
  renderCart();
}

function removeCart(i) {
  cart.splice(i, 1);
  save("cart", cart);
  renderCart();
}

// =================== ADMIN ===================
function loginAdmin() {
  const pass = document.getElementById("adminPass").value;
  if (pass === "1234") {
    document.getElementById("adminPanel").style.display = "block";
  } else {
    alert("Contraseña incorrecta");
  }
}

function addProduct() {
  const name = document.getElementById("pName").value;
  const price = document.getElementById("pPrice").value;
  const file = document.getElementById("pImg").files[0];
  
  if (!name || !price || !file) return alert("Completa todos los campos");

  const reader = new FileReader();
  reader.onload = function(e) {
    products.push({
      name,
      price,
      img: e.target.result
    });
    save("products", products);
    renderCatalog();
    alert("Producto agregado");
  };

  reader.readAsDataURL(file);
}

// =================== INICIAL ===================
renderCatalog();
renderCart();

</script>

</body>
</html>
