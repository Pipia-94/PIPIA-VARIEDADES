<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PIPIA VARIEDADES</title>

  <!-- React + ReactDOM + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #fafafa;
    }
    header {
      background: #222;
      color: white;
      padding: 15px;
      font-size: 20px;
      text-align: center;
    }
    .container {
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 15px;
    }
    .card {
      background: white;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 0 10px #0002;
    }
    .card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 8px;
    }
    button {
      padding: 10px;
      border: none;
      background: #222;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      width: 100%;
      margin-top: 8px;
    }
    button:active {
      opacity: 0.7;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

<header>PIPIA VARIEDADES</header>

<div id="root"></div>

<script type="text/babel">

/* ---------------------- LOCAL STORAGE HELPERS ---------------------- */
function load(key, fallback) {
  try { return JSON.parse(localStorage.getItem(key)) || fallback }
  catch { return fallback }
}
function save(key, data) {
  localStorage.setItem(key, JSON.stringify(data));
}

/* ---------------------- COMPONENTE PRINCIPAL ---------------------- */
const App = () => {
  const [products, setProducts] = React.useState(load("products", []));
  const [cart, setCart] = React.useState([]);
  const [admin, setAdmin] = React.useState(false);

  /* ---------------------- ADMIN LOGIN ---------------------- */
  const loginAdmin = () => {
    const pwd = prompt("Ingrese clave de administrador:");
    if (pwd === "1234") setAdmin(true);
    else alert("Clave incorrecta");
  };

  /* ---------------------- AGREGAR PRODUCTO ---------------------- */
  const addProduct = () => {
    const name = prompt("Nombre del producto:");
    if (!name) return;

    const price = prompt("Precio:");
    if (!price) return;

    const fileInput = document.createElement("input");
    fileInput.type = "file";

    fileInput.onchange = e => {
      const file = e.target.files[0];
      const reader = new FileReader();

      reader.onload = () => {
        const newProd = {
          id: Date.now(),
          name,
          price: Number(price),
          img: reader.result
        };

        const newList = [...products, newProd];
        setProducts(newList);
        save("products", newList);
      };

      reader.readAsDataURL(file);
    };

    fileInput.click();
  };

  /* ---------------------- ELIMINAR PRODUCTO ---------------------- */
  const deleteProduct = (id) => {
    if (!confirm("Eliminar producto?")) return;

    const filtered = products.filter(p => p.id !== id);
    setProducts(filtered);
    save("products", filtered);
  };

  /* ---------------------- AGREGAR AL CARRITO ---------------------- */
  const addToCart = (p) => {
    setCart([...cart, p]);
  };

  /* ---------------------- REALIZAR PEDIDO ---------------------- */
  const checkout = () => {
    if (cart.length === 0) return alert("Carrito vacío");

    const total = cart.reduce((acc, p) => acc + p.price, 0);

    alert(`Gracias! Tu pedido es de Q${total}. Se enviará por WhatsApp.`);
    setCart([]);
  };

  return (
    <div className="container">

      {/* BOTÓN ADMIN */}
      {!admin && (
        <button style={{background:"#444"}} onClick={loginAdmin}>
          Entrar como Admin
        </button>
      )}

      {/* CONTROLES ADMIN */}
      {admin && (
        <>
          <button style={{background:"#008000"}} onClick={addProduct}>
            Agregar Producto
          </button>
        </>
      )}

      {/* LISTADO DE PRODUCTOS */}
      <h2>Productos</h2>
      <div className="grid">
        {products.length === 0 && <p>No hay productos aún.</p>}

        {products.map(p => (
          <div className="card" key={p.id}>
            <img src={p.img} />
            <h3>{p.name}</h3>
            <p>Q{p.price}</p>

            <button onClick={() => addToCart(p)}>
              Agregar al carrito
            </button>

            {admin && (
              <button style={{background:"red"}} onClick={() => deleteProduct(p.id)}>
                Eliminar
              </button>
            )}
          </div>
        ))}
      </div>

      {/* CARRITO */}
      <h2>Carrito</h2>
      {cart.length === 0 && <p>No hay productos en el carrito.</p>}

      {cart.map((p,i) => (
        <div key={i}>
          {p.name} — Q{p.price}
        </div>
      ))}

      {cart.length > 0 && (
        <button style={{background:"#0066ff"}} onClick={checkout}>
          Finalizar Pedido
        </button>
      )}

    </div>
  );
};

/* RENDER DE LA APP */
ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>

</body>
</html>
