<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PIPIA VARIEDADES</title>

  <!-- React + ReactDOM + Babel (FUNCIONA EN GITHUB PAGES) -->
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { margin:0; font-family: Arial; background:#fafafa; }
    header { background:#222; color:white; padding:15px; text-align:center; }
    .container { padding:20px; max-width:900px; margin:auto; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:15px; }
    .card { background:white; border-radius:10px; padding:15px; box-shadow:0 0 10px #0002; }
    .card img { width:100%; height:160px; object-fit:cover; border-radius:8px; }
    button { padding:10px; width:100%; margin-top:8px; background:#222; color:white; border:none; border-radius:6px; cursor:pointer; }
    button:active { opacity:.7; }
    input { width:100%; padding:10px; margin-top:8px; }
  </style>
</head>
<body>

<header>PIPIA VARIEDADES</header>
<div id="root"></div>

<script type="text/babel">

/* ---------------------- STORAGE ---------------------- */
const load = (k,f)=>{ try{return JSON.parse(localStorage.getItem(k))||f}catch{return f}};
const save = (k,v)=>localStorage.setItem(k,JSON.stringify(v));

/* ---------------------- APP ---------------------- */
const App = () => {
  const [products,setProducts]=React.useState(load("products",[]));
  const [cart,setCart]=React.useState([]);
  const [admin,setAdmin]=React.useState(false);

  const loginAdmin=()=>{
    const p=prompt("Clave admin:");
    if(p==="1234") setAdmin(true);
    else alert("Clave incorrecta");
  };

  const addProduct=()=>{
    const name=prompt("Nombre:");
    if(!name) return;
    const price=prompt("Precio:");
    if(!price) return;

    const file=document.createElement("input");
    file.type="file";

    file.onchange=e=>{
      const reader=new FileReader();
      reader.onload=()=>{
        const newP={id:Date.now(),name,price:Number(price),img:reader.result};
        const newList=[...products,newP];
        setProducts(newList);
        save("products",newList);
      };
      reader.readAsDataURL(e.target.files[0]);
    };

    file.click();
  };

  const deleteProduct=id=>{
    if(!confirm("Eliminar?")) return;
    const list=products.filter(p=>p.id!==id);
    setProducts(list);
    save("products",list);
  };

  const addToCart=(p)=>setCart([...cart,p]);

  const checkout=()=>{
    if(cart.length===0) return alert("Carrito vacío");
    const total=cart.reduce((t,p)=>t+p.price,0);
    alert("Pedido realizado. Total: Q"+total);
    setCart([]);
  };

  return (
    <div className="container">

      {!admin && <button onClick={loginAdmin}>Entrar como Admin</button>}
      {admin && <button style={{background:"green"}} onClick={addProduct}>Agregar Producto</button>}

      <h2>Productos</h2>
      <div className="grid">
        {products.length===0 && <p>No hay productos.</p>}

        {products.map(p=>(
          <div className="card" key={p.id}>
            <img src={p.img}/>
            <h3>{p.name}</h3>
            <p>Q{p.price}</p>

            <button onClick={()=>addToCart(p)}>Agregar al carrito</button>

            {admin && <button style={{background:"red"}} onClick={()=>deleteProduct(p.id)}>Eliminar</button>}
          </div>
        ))}
      </div>

      <h2>Carrito</h2>
      {cart.length===0 && <p>No hay productos en el carrito.</p>}

      {cart.map((p,i)=>(
        <div key={i}>{p.name} — Q{p.price}</div>
      ))}

      {cart.length>0 && <button style={{background:"#0066ff"}} onClick={checkout}>Finalizar Pedido</button>}
    </div>
  );
};

/* ---- RENDER (React 17 funciona perfecto en GitHub Pages) ----- */
ReactDOM.render(<App/>, document.getElementById("root"));

</script>

</body>
</html>
